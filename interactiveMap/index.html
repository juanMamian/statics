<!DOCTYPE html>
<html>
<head>
    <title>Interactive World Map - Educational Theorists</title>
    <style>
        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .country {
            fill: #ccc;
            stroke: #fff;
            stroke-width: 0.5;
            transition: fill 0.3s;
        }
        
        .country:hover {
            fill: #66c2a5;
            cursor: pointer;
        }
        
        .country.has-theorist {
            fill: #ff7f7f;
        }
        
        .country.has-theorist:hover {
            fill: #ff4040;
        }

        .country.active {
            fill: #ff4040;
            stroke: #fff;
            stroke-width: 2;
        }

        #tooltip {
            position: absolute;
            padding: 8px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: 4px;
            font-family: Arial, sans-serif;
            font-size: 14px;
            pointer-events: none;
            display: none;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
        }

        .modal-content {
            position: relative;
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 600px;
        }

        .close {
            position: absolute;
            right: 20px;
            top: 10px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .theorist-img {
            width: 200px;
            height: 200px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 15px;
        }

        .theorist-info {
            font-family: Arial, sans-serif;
        }

        .timeline-container {
            width: 100%;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 8px;
        }

        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        #timeline {
            width: 100%;
            margin: 10px 0;
        }

        #year-display {
            font-size: 1.2em;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
        }

        h2 {
            color: #333;
            margin-bottom: 15px;
        }

        p {
            margin: 5px 0;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="map"></div>
        <div class="timeline-container">
            <div class="timeline-header">
                <span>1870</span>
                <div id="year-display">1870</div>
                <span>1921</span>
            </div>
            <input type="range" id="timeline" min="1870" max="1921" value="1870" step="1">
        </div>
    </div>
    <div id="tooltip"></div>
    <div id="theoristModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="theoristInfo" class="theorist-info"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script>
        const theorists = {
            'Italy': {
                name: 'Maria Montessori',
                birth: '31 de agosto de 1870',
                birthYear: 1870,
                place: 'Chiaravalle, Italia',
                img: 'profilePictures/montessori.webp',
                lastName: 'montessori'
            },
            'Switzerland': {
                name: 'Jean Piaget',
                birth: '9 de agosto de 1896',
                birthYear: 1896,
                place: 'Neuch√¢tel, Suiza',
                img: 'profilePictures/piaget.webp',
                lastName: 'piaget'
            },
            'United States of America': {
                name: 'Jerome Bruner',
                birth: '1 de octubre de 1915',
                birthYear: 1915,
                place: 'Nueva York, Estados Unidos',
                img: 'profilePictures/bruner.webp',
                lastName: 'bruner'
            },
            'Belarus': {
                name: 'Lev Vygotsky',
                birth: '17 de noviembre de 1896',
                birthYear: 1896,
                place: 'Orsha, Imperio ruso (actual Bielorrusia)',
                img: 'profilePictures/vygotsky.webp',
                lastName: 'vygotsky'
            },
            'Brazil': {
                name: 'Paulo Freire',
                birth: '19 de septiembre de 1921',
                birthYear: 1921,
                place: 'Recife, Brasil',
                img: 'profilePictures/freire.webp',
                lastName: 'freire'
            }
        };

        // Create the map container
        const width = 960;
        const height = 500;
        
        const svg = d3.select("#map")
            .append("svg")
            .attr("viewBox", `0 0 ${width} ${height}`)
            .attr("width", "100%")
            .attr("height", "auto");
        
        // Create a group for the map
        const g = svg.append("g");
        
        // Create projection
        const projection = d3.geoNaturalEarth1()
            .scale(width / 2 / Math.PI)
            .translate([width / 2, height / 2]);
        
        // Create path generator
        const path = d3.geoPath().projection(projection);
        
        // Modal functionality
        const modal = document.getElementById("theoristModal");
        const closeBtn = document.getElementsByClassName("close")[0];
        const timeline = document.getElementById("timeline");
        const yearDisplay = document.getElementById("year-display");
        
        closeBtn.onclick = function() {
            modal.style.display = "none";
        }
        
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        function showTheoristInfo(theorist) {
            const theoristInfo = document.getElementById("theoristInfo");
            theoristInfo.innerHTML = `
                <h2>${theorist.name}</h2>
                <img src="${theorist.img}" alt="${theorist.name}" class="theorist-img">
                <p><strong>Fecha de nacimiento:</strong> ${theorist.birth}</p>
                <p><strong>Lugar de nacimiento:</strong> ${theorist.place}</p>
            `;
            modal.style.display = "block";
        }

        function updateMapHighlights(year) {
            yearDisplay.textContent = year;
            
            // Remove all active classes first
            d3.selectAll(".country").classed("active", false);
            
            // Find theorists born in this year
            Object.entries(theorists).forEach(([country, theorist]) => {
                if (theorist.birthYear === parseInt(year)) {
                    d3.selectAll(".country")
                        .filter(d => d.properties.name === country)
                        .classed("active", true)
                        .each(function() {
                            // Trigger tooltip for the active country
                            const d = d3.select(this).datum();
                            const event = { pageX: width/2, pageY: height/2 }; // Default position
                            showTooltip(event, d);
                        });
                }
            });
        }

        function showTooltip(event, d) {
            const tooltip = d3.select("#tooltip");
            const countryName = d.properties.name;
            const text = theorists[countryName] ? 
                `${countryName} - ${theorists[countryName].name}` :
                countryName;
            
            tooltip.style("display", "block")
                .html(text)
                .style("left", (event.pageX + 10) + "px")
                .style("top", (event.pageY - 10) + "px");
        }

        // Timeline event listener
        timeline.addEventListener("input", function(e) {
            updateMapHighlights(e.target.value);
        });
        
        // Load and display the world map
        d3.json("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json").then(function(world) {
            const countries = topojson.feature(world, world.objects.countries);
            
            // Draw the countries
            g.selectAll("path")
                .data(countries.features)
                .enter()
                .append("path")
                .attr("class", d => {
                    const countryName = d.properties.name;
                    return `country ${theorists[countryName] ? 'has-theorist' : ''}`;
                })
                .attr("d", path)
                .on("mouseover", function(event, d) {
                    showTooltip(event, d);
                })
                .on("mouseout", function() {
                    d3.select("#tooltip").style("display", "none");
                })
                .on("click", function(event, d) {
                    const countryName = d.properties.name;
                    if (theorists[countryName]) {
                        showTheoristInfo(theorists[countryName]);
                    }
                });

            // Initialize with the first year
            updateMapHighlights(1870);
        });
        
        // Add zoom behavior
        const zoom = d3.zoom()
            .scaleExtent([1, 8])
            .on("zoom", (event) => {
                g.attr("transform", event.transform);
            });
        
        svg.call(zoom);
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/3.0.2/topojson.min.js"></script>
</body>
</html>
