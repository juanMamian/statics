<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive World Map - Educational Theorists (Spherical)</title>
    <style>
        /* Tooltip Styling */
        #tooltip {
            position: absolute;
            background-color: white;
            border: 1px solid black;
            padding: 5px;
            display: none;
            pointer-events: none;
        }

        .country {
            fill: lightgray;
            /* Default color for countries with no theorist info */
            stroke: #fff;
        }

        /* Highlighting Countries with Theorist Info */
        .has-theorist {
            fill: #ffcc00;
            /* Highlight color for countries with theorists */
            cursor: pointer;
        }


        .active {
            stroke: #ff0000;
            stroke-width: 2px;
        }

        /* Styling for Modal */
        .modal {
            display: none;
            /* Hidden by default */
            position: fixed;
            /* Stay in place */
            z-index: 1000;
            /* Sit on top */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
            /* Black background with opacity */
        }

        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid black;
            width: 80%;
            /* Can adjust the modal size */
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        .theorist-img {
            width: 100px;
            height: auto;
        }

        /* Container for Map and Timeline */
        .container {
            position: relative;
            width: 100%;
            height: auto;
        }

        /* Timeline Slider Styling */
        .timeline-container {
            width: 100%;
            text-align: center;
            position: absolute;
            bottom: -50px;
            /* Adjust slider position */
        }

        .timeline-header {
            display: flex;
            justify-content: space-between;
            width: 60%;
            margin: 0 auto;
        }

        #timeline {
            width: 60%;
            /* Make slider wider */
        }

        #year-display {
            font-size: 18px;
            font-weight: bold;
        }

        .slider-marks {
            position: relative;
            width: 60%;
            margin: 10px auto;
            display: flex;
            justify-content: space-between;
        }

        .slider-mark {
            width: 2px;
            height: 10px;
            background-color: black;
            position: absolute;
            top: -20px;
            /* Adjust the position so it aligns with the slider */
        }
    </style>
</head>

<body>
    <div class="container">
        <div id="map"></div>
        <div class="timeline-container">
            <div class="timeline-header">
                <span>1870</span>
                <div id="year-display">1870</div>
                <span>1921</span>
            </div>
            <div class="slider-marks" id="slider-marks">
                <!-- Slider marks will be dynamically added here -->
            </div>
            <input type="range" id="timeline" min="1870" max="1921" value="1870" step="1">
        </div>
    </div>
    <div id="tooltip"></div>

    <!-- Modal for Theorist Info -->
    <div id="theoristModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="theoristInfo" class="theorist-info"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/3.0.2/topojson.min.js"></script>
    <script>
        const theorists = {
            'Colombia':{
                name: 'Catalina Bravo',
                birth: '19 de diciembre de 2001',
                birthYear: 2001,
                place: 'Popayán, Colombia',
                img: 'profilePictures/bravo.webp',
                lastName: 'bravo'
            },
            'Italy': {
                name: 'Maria Montessori',
                birth: '31 de agosto de 1870',
                birthYear: 1870,
                place: 'Chiaravalle, Italia',
                img: 'profilePictures/montessori.webp',
                lastName: 'montessori'
            },
            'Switzerland': {
                name: 'Jean Piaget',
                birth: '9 de agosto de 1896',
                birthYear: 1896,
                place: 'Neuchâtel, Suiza',
                img: 'profilePictures/piaget.webp',
                lastName: 'piaget'
            },
            'United States of America': {
                name: 'Jerome Bruner',
                birth: '1 de octubre de 1915',
                birthYear: 1915,
                place: 'Nueva York, Estados Unidos',
                img: 'profilePictures/bruner.webp',
                lastName: 'bruner'
            },
            'Belarus': {
                name: 'Lev Vygotsky',
                birth: '17 de noviembre de 1896',
                birthYear: 1896,
                place: 'Orsha, Imperio ruso (actual Bielorrusia)',
                img: 'profilePictures/vygotsky.webp',
                lastName: 'vygotsky'
            },
            'Brazil': {
                name: 'Paulo Freire',
                birth: '19 de septiembre de 1921',
                birthYear: 1921,
                place: 'Recife, Brasil',
                img: 'profilePictures/freire.webp',
                lastName: 'freire'
            }
        };

        const theoristYears = Object.values(theorists).map(theorist => theorist.birthYear);

        // Create the map container
        const width = 960;
        const height = 500;

        const svg = d3.select("#map")
            .append("svg")
            .attr("viewBox", `0 0 ${width} ${height}`)
            .attr("width", "100%")
            .attr("height", "auto");

        const g = svg.append("g");

        // Create spherical projection (Orthographic)
        const projection = d3.geoOrthographic()
            .scale(240)  // Control the size of the globe
            .translate([width / 2, height / 2])
            .clipAngle(90) // Clip to show only the visible hemisphere
            .precision(0.1);

        const path = d3.geoPath().projection(projection);

        // Tooltip functionality
        function showTooltip(event, d) {
            const tooltip = d3.select("#tooltip");
            const countryName = d.properties.name;
            const theorist = theorists[countryName];

            tooltip.style("display", "block")
                .style("left", (event.pageX + 10) + "px")
                .style("top", (event.pageY - 10) + "px")
                .html(theorist
                    ? `<strong>${theorist.name}</strong><br>${theorist.birth}`
                    : `<strong>${countryName}</strong>`);
        }

        // Function to hide the tooltip
        function hideTooltip() {
            d3.select("#tooltip").style("display", "none");
        }

        // Function to rotate the globe
        function rotateGlobe([x, y]) {
            projection.rotate([x, y]);
            g.selectAll("path").attr("d", path);  // Re-render the paths with new rotation
        }

        // Modal functionality
        const modal = document.getElementById("theoristModal");
        const closeBtn = document.getElementsByClassName("close")[0];
        const timeline = document.getElementById("timeline");
        const yearDisplay = document.getElementById("year-display");

        closeBtn.onclick = function () {
            modal.style.display = "none";
        }

        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        function showTheoristInfo(theorist) {
            const theoristInfo = document.getElementById("theoristInfo");
            theoristInfo.innerHTML = `
                <h2>${theorist.name}</h2>
                <img src="${theorist.img}" alt="${theorist.name}" class="theorist-img">
                <p><strong>Fecha de nacimiento:</strong> ${theorist.birth}</p>
                <p><strong>Lugar de nacimiento:</strong> ${theorist.place}</p>
            `;
            modal.style.display = "block";
        }

        function updateMapHighlights(year) {
            yearDisplay.textContent = year;

            d3.selectAll(".country").classed("active", false);
            Object.entries(theorists).forEach(([country, theorist]) => {
                if (theorist.birthYear === parseInt(year)) {
                    d3.selectAll(".country")
                        .filter(d => d.properties.name === country)
                        .classed("active", true);
                }
            });
        }

        function rotateToCountry(countryName) {
            d3.selectAll(".country")
                .filter(d => d.properties.name === countryName)
                .each(d => {
                    const centroid = d3.geoCentroid(d);
                    projection.rotate([-centroid[0], -centroid[1]]); // Rotate to country
                    g.selectAll("path").attr("d", path);  // Re-render map
                });
        }

        // Zoom and rotation
        const zoom = d3.zoom()
            .scaleExtent([1, 8])
            .on("zoom", (event) => {
                const scale = event.transform.k * 240; // Adjust scale based on zoom
                projection.scale(scale);
                g.selectAll("path").attr("d", path);  // Re-render the map
            });

        svg.call(zoom);

        svg.on("mousedown", (event) => {
            const [x0, y0] = d3.pointer(event);
            svg.on("mousemove", (event) => {
                const [x1, y1] = d3.pointer(event);
                const dx = x1 - x0;
                const dy = y1 - y0;
                projection.rotate([dx, -dy]); // Rotate based on drag
                g.selectAll("path").attr("d", path);  // Re-render the map
            });
        }).on("mouseup", () => svg.on("mousemove", null));

        // Fetch and render map data
        d3.json("https://unpkg.com/world-atlas@2.0.2/countries-110m.json").then(worldData => {
            const countries = topojson.feature(worldData, worldData.objects.countries).features;

            g.selectAll("path")
                .data(countries)
                .enter()
                .append("path")
                .attr("class", "country")
                .attr("d", path)
                .classed("has-theorist", d => theorists[d.properties.name] ? true : false)
                .on("mouseover", showTooltip)
                .on("mouseout", hideTooltip)
                .on("click", function (event, d) {
                    const countryName = d.properties.name;
                    if (theorists[countryName]) {
                        showTheoristInfo(theorists[countryName]);
                    }
                });
        });

        // Update slider marks for years with theorist info
        const sliderMarks = document.getElementById("slider-marks");
        theoristYears.forEach(year => {
            const mark = document.createElement("div");
            mark.className = "slider-mark";
            mark.style.left = `${((year - 1870) / (1921 - 1870)) * 100}%`;
            sliderMarks.appendChild(mark);
        });

        // Timeline change event listener
        timeline.addEventListener('input', function () {
            updateMapHighlights(this.value);
            const year = parseInt(this.value);
            const theoristForYear = Object.values(theorists).find(theorist => theorist.birthYear === year);
            if (theoristForYear) {
                rotateToCountry(theoristForYear.place.split(",")[1].trim());
            }
        });
    </script>
</body>

</html>
